<div class="bc-avatar" style="background: url({{vm.account.imageUrl}}) center no-repeat; background-size: cover;"
     ng-class="vm.detectBlur()">
</div>
<div ng-cloak>
    <div id="one">
        <div ng-switch="vm.isAuthenticated()">
            <div class="signin-train" ng-switch-when="true">
                <img src="/content/images/new-year.png" ng-if="vm.isNewYearHolidays()" class="new-year-hat-1">
                <p class="welcome md-headline">Добро пожаловать, {{vm.account.firstName}}!</p>
                <p class="o1">Для СМС-оповещений требуется указать в свой телефон в <a ui-sref="settings">настройках</a>.</p>
                <div ng-if="vm.account.city == null">
                    <p class="o1">Для просмотра тренировок необходимо выбрать город:</p>
                    <md-select ng-init="vm.loadCities()" id="home_city" ng-model="vm.account.city" aria-label="city" md-on-close="vm.saveAccount()">
                        <md-option ng-repeat="city in vm.cities | orderBy:'name'" ng-value="city">
                            {{city.name}}
                        </md-option>
                    </md-select>
                </div>
                <jhi-alert></jhi-alert>
                <jhi-alert-error></jhi-alert-error>
                <div class="train-list" ng-if="vm.account.city" ng-init="vm.loadTrainings()">
                    <md-select ng-model="currentLevel" aria-label="levels" ng-show="vm.levels.length > 1" md-on-close="vm.selectLevel(currentLevel)">
                        <md-option ng-repeat="level in vm.levels | orderBy:'order'" ng-value="level">
                            {{level.name}}
                        </md-option>
                    </md-select>
                    <ul>
                        <li class="training-warn" ng-show="!vm.levels.length">Тренировок пока нет.</li>
                        <li ng-repeat="training in vm.trainings | filter: filterByLevel(currentLevel) | orderBy:'startAt'">
                            <md-card ng-model="hcontent">
                                <md-card-title class="card-title-sm">
                                    <md-card-title-media>
                                        <div class="md-media-sm card-media training">
                                            <span class="training-day">{{training.startAt | date:'EEEE'}}</span>
                                            <br/>
                                            <span class="md-subhead training-date">{{training.startAt | date:'d'}}</span>
                                            <br/>
                                            <span class="training-month">{{training.startAt | date:'MMMM'}}</span>
                                        </div>
                                    </md-card-title-media>
                                    <md-card-title-text class="card-with-border">
                                        <span class="md-headline" ng-show="training.description">{{training.description}}</span>
                                        <span class="md-subhead">{{training.startAt | date:'shortTime':vm.account.city.tz}}, {{training.price}} р</span>
                                        <span class="md-subhead">{{training.gym.name}}</span>
                                        <span class="md-subhead">Лимит {{training.limit}} человек</span>
                                    </md-card-title-text>
                                </md-card-title>
                                <md-card-actions layout="row" layout-align="end center">
                                    <md-button class="md-flat" ng-click="hcontent = !hcontent">Подробнее</md-button>
                                    <md-button class="md-flat md-primary"
                                               ng-disabled="vm.account.readOnly"
                                               ng-if="!vm.alreadyRegister(training.id)"
                                               ng-click="vm.enroll(training.id)">Записаться</md-button>
                                    <md-button class="md-flat md-warn"
                                               ng-if="vm.alreadyRegister(training.id)"
                                               ng-click="showConfirm($event, training.id)">Отписаться</md-button>
                                </md-card-actions>

                                <div ng-show="hcontent && training.state == 'REGISTRATION'">
                                    <!--div ng-if="!vm.alreadyRegister(training.id)">
                                        <form name="form" role="form" novalidate ng-submit="vm.enroll(training.id)" show-validation>
                                            <input type="text" class="form-control" placeholder="{{'home.form.phone.placeholder' | translate}}" name="phone" id="phone"
                                                   ng-model="vm.account.phone" ng-value="vm.account.phone" ng-pattern="/^\+7[0-9]{10,10}$/">
                                            <div ng-show="form.phone.$dirty && form.phone.$invalid || !vm.account.phone">
                                                <p class="help-block"
                                                   ng-show="form.phone.$error.pattern" translate="home.messages.validate.phone.pattern">
                                                    Your phone must match number pattern: +7XXXXXXXXXX.
                                                </p>
                                            </div>
                                            <button type="submit" class="enroll" ng-disabled="form.$invalid">Записаться</button>
                                        </form>
                                    </div>
                                    <div ng-if="vm.alreadyRegister(training.id)">
                                        <a class="unroll" ng-click="vm.unroll(training.id)">Отписаться</a>
                                    </div-->
                                    <ul class="users-list">
                                        <li ng-repeat="trainingUser in training.trainingUsers | orderBy:'registerDate'">
                                            <img ng-src="{{trainingUser.user.imageUrl || '/content/images/nouser.png'}}">
                                            <span ng-class="$index >= training.limit ? 'red' : ''">
                                            {{$index+1}}. {{trainingUser.user.firstName}}
                                        </span>
                                        </li>
                                        <li>
                                            <img class="refresh" src="/content/images/refresh.png" ng-click="vm.loadTrainings()">
                                            <span class="refresh">Обновить</span>
                                        </li>
                                    </ul>
                                </div>
                                <!--todo cancelled view-->
                                <div class="alert" ng-if="hcontent && training.state == 'CANCELLED'">
                                    Тренировка отменена.
                                </div>
                            </md-card>
                        </li>
                    </ul>
                </div>
            </div>

            <script type="text/ng-template" id="popupTmpl.html">
                <div class="modal-header">
                    <h3 class="modal-title">You registered!</h3>
                </div>
                <div class="modal-body">
                    User: <b>{{ vm.account.login }}</b>
                    <hr/>
                    Number: <b>{{ vm.training.id }}</b>
                    <hr/>
                    {{ vm.modalText }}
                </div>
                <div class="modal-footer">
                    <button close-dialog="2" class="btn btn-primary">OK</button>
                </div>
            </script>

            <div class="signup-train" ng-switch-when="false">
                <p class="welcome md-headline">Добро пожаловать!<br />Cнова.</p>
                <p class="o2">Для записи на тренировку необходимо <a class="alert-link" href="" ng-click="vm.login()">войти на сайт здесь</a>, либо через одну из соц. сетей</p>

                <div id="cf">
                    <jh-social ng-provider="vkontakte"></jh-social>
                    <jh-social ng-provider="google"></jh-social>
                    <jh-social ng-provider="facebook"></jh-social>
                </div>
            </div>
        </div>
    </div>
</div>
